<section class="max-w-6xl mx-auto px-4 pt-6 pb-16">
  <!-- Header card -->
  <article
    class="relative overflow-hidden rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl ring-1 ring-white/10 shadow-2xl mb-6"
  >
    <div
      class="pointer-events-none absolute -top-24 -left-24 h-64 w-64 rounded-full bg-pink-500/20 blur-3xl"
    ></div>
    <div
      class="pointer-events-none absolute -bottom-24 -right-24 h-64 w-64 rounded-full bg-fuchsia-500/20 blur-3xl"
    ></div>

    <div class="relative p-5 md:p-6">
      <div class="flex items-start justify-between gap-3">
        <div>
          <h1 class="text-2xl md:text-3xl font-extrabold text-white">
            Crear evento
          </h1>
          <p class="text-sm text-slate-400 mt-1">
            Asocia un club, agrega artistas y categorías, sube una imagen y
            programa fechas.
          </p>
        </div>
        <fest-button
          label="Guardar"
          [loading]="isSaving"
          (clicked)="onSubmit()"
        ></fest-button>
      </div>
    </div>
  </article>

  <!-- Main layout -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- LEFT: Form -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Club (obligatorio, solo uno) -->
      <section
        class="rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl ring-1 ring-white/10 shadow-xl p-4 md:p-5"
      >
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-sm font-semibold text-slate-200">Club</h2>
          <span class="text-xs text-rose-300/90">Obligatorio</span>
        </div>

        @if (!selectedClub) {
        <div class="relative">
          <label class="sr-only" for="clubSearch">Buscar club</label>
          <input
            id="clubSearch"
            type="text"
            [(ngModel)]="clubQuery"
            (input)="filterClubs()"
            placeholder="Busca y selecciona un club…"
            class="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-2.5 text-slate-100 placeholder:text-slate-400 outline-none focus:ring-2 focus:ring-pink-500/40"
            autocomplete="off"
          />
          @if (clubQuery.trim().length > 0) {
          <ul
            class="absolute z-20 mt-2 w-full max-h-60 overflow-auto rounded-xl border border-white/10 bg-neutral-900/95 ring-1 ring-white/10"
          >
            @for (c of filteredClubs; track c.id) {
            <li>
              <button
                type="button"
                class="w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-white/10"
                (click)="selectClub(c)"
              >
                <img
                  [src]="c.logoUrl || '/assets/placeholder-club.png'"
                  class="h-8 w-8 rounded-lg object-cover border border-white/10"
                  alt=""
                />
                <span class="text-sm text-slate-100">{{ c.name }}</span>
              </button>
            </li>
            } @if (filteredClubs.length === 0) {
            <li class="px-3 py-2 text-sm text-slate-400">Sin resultados…</li>
            }
          </ul>
          }
        </div>
        } @else {
        <div class="flex items-center justify-between gap-3">
          <div class="flex items-center gap-3 min-w-0">
            <img
              [src]="selectedClub.logoUrl || '/assets/placeholder-club.png'"
              class="h-12 w-12 rounded-xl object-cover border border-white/10"
              alt="Logo club"
            />
            <div class="min-w-0">
              <p class="text-xs text-slate-400">Seleccionado</p>
              <p class="font-semibold text-slate-100 truncate">
                {{ selectedClub.name }}
              </p>
            </div>
          </div>
          <button
            type="button"
            class="rounded-lg border border-white/10 px-3 py-1.5 text-xs text-slate-200 hover:bg-white/10"
            (click)="clearClub()"
          >
            Cambiar
          </button>
        </div>
        }
      </section>

      <!-- Título (obligatorio) -->
      <section
        class="rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl ring-1 ring-white/10 shadow-xl p-4 md:p-5"
      >
        <label class="block text-sm font-semibold text-slate-200 mb-2"
          >Título
          <span class="text-rose-300/90 text-xs">obligatorio</span></label
        >
        <input
          type="text"
          [(ngModel)]="title"
          maxlength="120"
          placeholder="Ej. Latin Night @ Casablanca"
          class="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-2.5 text-slate-100 placeholder:text-slate-400 outline-none focus:ring-2 focus:ring-pink-500/40"
        />
        <div class="mt-1 text-xs text-slate-400">
          {{ title.length || 0 }}/120
        </div>
      </section>

      <!-- Descripción (opcional) -->
      <section
        class="rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl ring-1 ring-white/10 shadow-xl p-4 md:p-5"
      >
        <div class="flex items-center justify-between mb-2">
          <label class="block text-sm font-semibold text-slate-200"
            >Descripción</label
          >
          <span class="text-xs text-slate-400">Opcional</span>
        </div>
        <textarea
          [(ngModel)]="description"
          rows="5"
          placeholder="Describe la experiencia, dress code, age limit, etc."
          class="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-2.5 text-slate-100 placeholder:text-slate-400 outline-none focus:ring-2 focus:ring-pink-500/40"
        ></textarea>
      </section>

      <!-- Artistas invitados (0..n) -->
      <section
        class="rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl ring-1 ring-white/10 shadow-xl p-4 md:p-5"
      >
        <div class="flex items-center justify-between">
          <h2 class="text-sm font-semibold text-slate-200">
            Artistas invitados
          </h2>
          <span class="text-xs text-slate-400">Opcional</span>
        </div>

        <div class="mt-3 relative">
          <input
            type="text"
            [(ngModel)]="artistQuery"
            (input)="filterArtists()"
            placeholder="Busca por nombre…"
            class="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-2.5 text-slate-100 placeholder:text-slate-400 outline-none focus:ring-2 focus:ring-pink-500/40"
            autocomplete="off"
          />
          @if (artistQuery.trim().length > 0) {
          <ul
            class="absolute z-20 mt-2 w-full max-h-60 overflow-auto rounded-xl border border-white/10 bg-neutral-900/95 ring-1 ring-white/10"
          >
            @for (a of filteredArtists; track a.id) {
            <li>
              <button
                type="button"
                class="w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-white/10"
                (click)="addArtist(a)"
              >
                <img
                  [src]="a.avatarUrl || '/assets/placeholder-artist.png'"
                  class="h-8 w-8 rounded-full object-cover border border-white/10"
                  alt=""
                />
                <span class="text-sm text-slate-100">{{ a.name }}</span>
              </button>
            </li>
            } @if (filteredArtists.length === 0) {
            <li class="px-3 py-2 text-sm text-slate-400">Sin resultados…</li>
            }
          </ul>
          }
        </div>

        <!-- Lista de artistas agregados -->
        @if (selectedArtists.length > 0) {
        <div class="mt-3 flex flex-wrap gap-3">
          @for (a of selectedArtists; track a.id) {
          <div
            class="flex items-center gap-2 rounded-xl border border-white/10 bg-white/5 px-2.5 py-1.5"
          >
            <img
              [src]="a.avatarUrl || '/assets/placeholder-artist.png'"
              class="h-6 w-6 rounded-full object-cover border border-white/10"
              alt=""
            />
            <span class="text-sm text-slate-100">{{ a.name }}</span>
            <button
              type="button"
              class="ml-1 rounded-md px-1.5 py-0.5 text-xs text-slate-300 hover:bg-white/10"
              (click)="removeArtist(a)"
              aria-label="Quitar artista"
            >
              ✕
            </button>
          </div>
          }
        </div>
        }
      </section>

      <!-- Categorías (chips, 1..n) -->
      <section
        class="rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl ring-1 ring-white/10 shadow-xl p-4 md:p-5"
      >
        <div class="flex items-center justify-between">
          <h2 class="text-sm font-semibold text-slate-200">Categorías</h2>
          <span class="text-xs text-rose-300/90">Al menos 1</span>
        </div>

        <div class="mt-3 flex flex-wrap gap-2">
          @for (cat of categories; track cat) {
          <button
            type="button"
            class="px-4 py-1.5 rounded-full border text-sm font-medium transition select-none"
            [class]="
              selectedCategories.has(cat)
                ? 'border-pink-500 text-white bg-pink-600/20'
                : 'border-white/15 text-slate-300 hover:bg-white/10'
            "
            (click)="toggleCategory(cat)"
          >
            {{ cat }}
          </button>
          }
        </div>
      </section>

      <!-- Fechas & horas (1..n) -->
      <section
        class="rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl ring-1 ring-white/10 shadow-xl p-4 md:p-5"
      >
        <div class="flex items-center justify-between">
          <h2 class="text-sm font-semibold text-slate-200">Fechas y horas</h2>
          <span class="text-xs text-rose-300/90">Al menos 1</span>
        </div>

        <div class="mt-3 space-y-3">
          @for (sch of schedules; track $index; let i = $index) {
          <div class="rounded-xl border border-white/10 bg-white/5 p-3">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-3 items-end">
              <div>
                <label class="block text-xs text-slate-400 mb-1"
                  >Fecha inicio</label
                >
                <input
                  type="date"
                  [(ngModel)]="sch.date"
                  class="w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-slate-100 outline-none focus:ring-2 focus:ring-pink-500/40"
                />
              </div>
              <div>
                <label class="block text-xs text-slate-400 mb-1"
                  >Hora inicio</label
                >
                <input
                  type="time"
                  [(ngModel)]="sch.time"
                  class="w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-slate-100 outline-none focus:ring-2 focus:ring-pink-500/40"
                />
              </div>
              <div>
                <label class="block text-xs text-slate-400 mb-1"
                  >Fecha fin (opcional)</label
                >
                <input
                  type="date"
                  [(ngModel)]="sch.endDate"
                  class="w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-slate-100 outline-none focus:ring-2 focus:ring-pink-500/40"
                />
              </div>
              <div class="flex items-end gap-2">
                <div class="flex-1">
                  <label class="block text-xs text-slate-400 mb-1"
                    >Hora fin (opcional)</label
                  >
                  <input
                    type="time"
                    [(ngModel)]="sch.endTime"
                    class="w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-slate-100 outline-none focus:ring-2 focus:ring-pink-500/40"
                  />
                </div>
                <button
                  type="button"
                  class="self-end rounded-lg border border-white/10 px-3 py-2 text-xs text-slate-200 hover:bg-white/10"
                  (click)="removeSchedule(i)"
                  [disabled]="schedules.length === 1"
                >
                  Eliminar
                </button>
              </div>
            </div>
          </div>
          }
        </div>

        <div class="mt-3">
          <button
            type="button"
            class="rounded-lg border border-pink-400/30 px-3 py-2 text-xs font-semibold text-pink-200 bg-pink-600/20 hover:bg-pink-600/30"
            (click)="addSchedule()"
          >
            + Agregar fecha
          </button>
        </div>
      </section>

      <!-- Imagen (obligatoria, solo 1) -->
      <section
        class="rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl ring-1 ring-white/10 shadow-xl p-4 md:p-5"
      >
        <div class="flex items-center justify-between mb-2">
          <h2 class="text-sm font-semibold text-slate-200">
            Imagen del evento
          </h2>
          <span class="text-xs text-rose-300/90">Obligatoria (1)</span>
        </div>

        @if (!imagePreview) {
        <div
          class="relative rounded-2xl border border-dashed border-white/15 bg-white/5 p-6 text-center"
        >
          <p class="text-sm text-slate-300">
            Arrastra y suelta una imagen aquí
          </p>
          <p class="text-xs text-slate-400 mt-1">o</p>
          <label
            class="mt-3 inline-flex cursor-pointer items-center gap-2 rounded-xl px-3 py-2 text-sm font-semibold text-white bg-gradient-to-r from-pink-500 to-fuchsia-600 shadow-[0_10px_30px_-10px_rgba(236,72,153,0.6)] hover:from-pink-400 hover:to-fuchsia-500"
          >
            <input
              type="file"
              class="hidden"
              accept="image/*"
              (change)="onImageSelected($event)"
            />
            Subir imagen
          </label>

          <!-- Drag & drop -->
          <div
            class="absolute inset-0"
            (dragover)="onDragOver($event)"
            (drop)="onDrop($event)"
          ></div>
        </div>
        } @else {
        <div
          class="relative overflow-hidden rounded-2xl border border-white/10"
        >
          <img
            [src]="imagePreview"
            class="w-full h-60 object-cover"
            alt="Preview"
          />
          <div
            class="absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent"
          ></div>
          <div class="absolute bottom-3 right-3 flex gap-2">
            <label
              class="inline-flex cursor-pointer items-center gap-2 rounded-lg px-3 py-1.5 text-xs font-semibold text-white bg-white/10 hover:bg-white/15 border border-white/15"
            >
              <input
                type="file"
                class="hidden"
                accept="image/*"
                (change)="onImageSelected($event)"
              />
              Cambiar
            </label>
            <button
              type="button"
              class="rounded-lg px-3 py-1.5 text-xs font-semibold text-rose-200 bg-rose-600/20 hover:bg-rose-600/30 border border-rose-400/30"
              (click)="removeImage()"
            >
              Eliminar
            </button>
          </div>
        </div>
        }
      </section>
    </div>

    <!-- RIGHT: Preview (maqueta) -->
    <aside class="lg:col-span-1 space-y-6">
      <div
        class="rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl ring-1 ring-white/10 shadow-xl p-4"
      >
        <h3 class="text-sm font-semibold text-slate-200">Preview</h3>
        <div class="mt-3 overflow-hidden rounded-xl border border-white/10">
          <div class="relative aspect-[16/10] bg-neutral-900">
            <img
              *ngIf="imagePreview"
              [src]="imagePreview"
              class="h-full w-full object-cover"
              alt=""
            />
            <div
              class="absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent"
            ></div>
            <div
              class="absolute left-3 bottom-3 flex flex-wrap items-center gap-2"
            >
              @for (item of selectedCategories; track $index) {
              <span
                class="inline-flex items-center px-3 py-1 rounded-full bg-black/50 text-white text-xs ring-1 ring-white/15"
                >{{ item }}</span
              >
              }
            </div>
          </div>
          <div class="p-3">
            <p class="text-xs text-slate-400">
              {{ selectedClub?.name || "Club no seleccionado" }}
            </p>
            <p class="font-extrabold text-slate-100 leading-snug mt-1">
              {{ title || "Título del evento" }}
            </p>
            <p class="mt-1 text-sm text-slate-400 line-clamp-3">
              {{ description || "Descripción del evento…" }}
            </p>
            @if (schedules.length > 0) {
            <div class="mt-2 text-xs text-slate-300">
              Próxima: {{ displayNextSchedule() }}
            </div>
            } @if (selectedArtists.length > 0) {
            <div class="mt-3 flex -space-x-2">
              @for (a of selectedArtists; track a.id) {
              <img
                [src]="a.avatarUrl || '/assets/placeholder-artist.png'"
                class="h-7 w-7 rounded-full border-2 border-neutral-800 object-cover"
                alt=""
              />
              }
            </div>
            }
          </div>
        </div>
      </div>

      <div
        class="rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl ring-1 ring-white/10 shadow-xl p-4"
      >
        <h3 class="text-sm font-semibold text-slate-200">Acciones</h3>
        <div class="mt-3 flex flex-col gap-2">
          <fest-button
            label="Guardar"
            [loading]="isSaving"
            (clicked)="onSubmit()"
          ></fest-button>
          <button
            type="button"
            class="rounded-xl border border-white/10 px-4 py-2.5 text-sm text-slate-200 hover:bg-white/10"
          >
            Cancelar
          </button>
        </div>
        <div class="mt-3 text-xs text-slate-400">
          Estado del formulario:
          <span [class]="formValid() ? 'text-emerald-300' : 'text-rose-300'">
            {{ formValid() ? "Listo para guardar" : "Incompleto" }}
          </span>
        </div>
      </div>
    </aside>
  </div>
</section>
